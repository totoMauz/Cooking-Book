<!DOCTYPE html>
<html lang="en">
<style>
  body {
    font-size: 4rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: oldlace;
    background-color: slategrey;
  }

  .content h2 {
    margin-top: 1rem;
    margin-bottom: 0rem;
  }

  .content {
    padding-left: 2rem;
  }

  .content ul {
    margin-top: 0rem;
    margin-bottom: 1rem;
    list-style-type: none;
  }

  .content li {
    border-radius: 1rem;
    padding-left: 0.5rem;
    margin-top: 0.5rem;
    color: black;
    width: 30rem;
  }

  .content li:nth-child(even) {
    background-color: cadetblue;
  }

  .content li:nth-child(odd) {
    background-color: teal;
  }
</style>

<head>
  <meta charset="utf-8">
  <title>Einkaufsliste</title>
</head>

<body onload="getShoppingList()">
  <section class="content" id="content"></section>
</body>

<script language="javascript">
  function cleanContent() {
    return Promise.resolve().then(() => {
      const oContent = document.getElementById("content");
      while (oContent.firstChild) {
        oContent.removeChild(oContent.firstChild);
      }
    });
  }

  function queryShoppingList() {
    return new Promise((resolve, reject) => {
      const xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState == 4) {
          if (xmlHttp.status == 200) {
            resolve(JSON.parse(xmlHttp.response));
          }
          else {
            reject(xmlHttp.responseText);
          }
        }
      }
      xmlHttp.open("GET", "/getShoppingList", true);
      xmlHttp.send(null);
    });
  }

  function getShoppingList() {
    const oHeader = document.createElement('h1');
    const oContent = document.getElementById("content");
    let oNewContent = [];

    return cleanContent()
      .then(() => { return queryShoppingList() })
      .then((shoppingList) => {
        oHeader.innerText = "Einkaufsliste";

        Object.keys(shoppingList).forEach((category) => {
          const oSubHeader = document.createElement('h2');
          oSubHeader.innerText = category;
          oNewContent.push(oSubHeader);

          const oList = document.createElement('ul');
          oNewContent.push(oList);

          shoppingList[category].forEach((item) => {
            const oItem = document.createElement('li');
            oItem.appendChild(document.createTextNode(item.name));
            if (item.amount) {
              oItem.appendChild(document.createTextNode(`: ${item.amount}`));
            }
            oList.appendChild(oItem);
          });

        });



        "{\"GemÃ¼se\": [{\"name\": \"Gurke\"}], \"Obst\": [{\"name\": \"Banane\"}]}"



      }).catch((err) => {
        oHeader.innerText = "Fehler";
        oNewContent = document.createElement('span');
        oNewContent.innerText = err;
      }).finally(() => {
        oContent.appendChild(oHeader);
        if (Array.isArray(oNewContent)) {
          oNewContent.forEach((newContent) => {
            oContent.appendChild(newContent);
          });
        }
        else {
          oContent.appendChild(oNewContent);
        }
      });
  }
</script>

</html>